

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ODA Canvas - Phase 1 (MVP) CTK &mdash; ODA-Component Accelerator v1beta1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> ODA-Component Accelerator
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About the project:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Playbook.html">Introduction to the ODA Component Accelerator Project (ODA-CA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Getting_started.html">Getting started checklist for new members of ODA-CA</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/Observability-Tutorial/README.html">Tutorial to deploy and observe a running component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/ODAComponentTutorial/README.html">Tutorial to build ODA-Component from Open-API Reference Implemenation</a></li>
</ul>
<p class="caption"><span class="caption-text">Component:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/ODAComponentDesignGuidelines.html">Design Guidelines to create a new ODA Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ctk/README.html">ODA Component - CTK</a></li>
</ul>
<p class="caption"><span class="caption-text">Canvas:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/README.html">ODA Canvas installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Canvas-design.html">ODA Canvas Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecase-library/README.html">ODA Canvas - use-case library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usecase-library/index.html">ODA-Canvas - Usecase list</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">ODA-Canvas - Compliance Test Kit (CTK)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/operators/index.html">Open Digital Architecture - Controllers/Operators</a></li>
</ul>
<p class="caption"><span class="caption-text">Troubleshooting Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/TroubleshootingGuide/index.html">ODA-CA Troubleshooting Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributions Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/ContributionsGuide.html">Contribution guidance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/DocumentationProcess.html">Documentation Process</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ODA-Component Accelerator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ODA Canvas - Phase 1 (MVP) CTK</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/canvas/compliance-test-kit/Phase-1-CTK.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="oda-canvas-phase-1-mvp-ctk">
<h1>ODA Canvas - Phase 1 (MVP) CTK<a class="headerlink" href="#oda-canvas-phase-1-mvp-ctk" title="Permalink to this headline">¶</a></h1>
<p>Following the same approach as the <a class="reference external" href="https://github.com/tmforum-oda/oda-component-ctk">ODA Component CTK</a>, this repository contains the tests that can be executed to check compliance with the Canvas design guidelines.</p>
<p>Temporarily, these design guidelines can be found here: https://github.com/tomkivlin/oda-ca-docs/blob/patch-1/ODACanvasDesignGuidelines.md</p>
<div class="section" id="executing-the-ctk-tests">
<h2>Executing the CTK tests<a class="headerlink" href="#executing-the-ctk-tests" title="Permalink to this headline">¶</a></h2>
<p>To prepare for running the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">tmforum</span><span class="o">-</span><span class="n">oda</span><span class="o">/</span><span class="n">oda</span><span class="o">-</span><span class="n">canvas</span><span class="o">-</span><span class="n">ctk</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">oda</span><span class="o">-</span><span class="n">canvas</span><span class="o">-</span><span class="n">ctk</span>
<span class="n">npm</span> <span class="n">install</span>
</pre></div>
</div>
<p>To run <strong>all</strong> the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">test</span>
</pre></div>
</div>
<p>To run only the <strong>mandatory</strong> tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CANVAS_CTK_MANDATORY_ONLY</span><span class="o">=</span><span class="n">true</span> <span class="n">npm</span> <span class="n">test</span>
</pre></div>
</div>
<p>To control which optional tests are run, set one of the following environment variables to <code class="docutils literal notranslate"><span class="pre">true</span></code></p>
<ul class="simple">
<li><p>CANVAS_CTK_OPTIONAL_KEYCLOAK=true</p></li>
<li><p>CANVAS_CTK_OPTIONAL_ISTIO=true</p></li>
</ul>
<p>e.g. the following will include the optional keycloak test, but not Istio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CANVAS_CTK_OPTIONAL_KEYCLOAK</span><span class="o">=</span><span class="n">true</span> <span class="n">npm</span> <span class="n">test</span>
</pre></div>
</div>
<p>e.g. the following will include both the keycloak and istio optional tests (today, this is the same as running all tests, but as more optional tests are added it may be useful):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CANVAS_CTK_OPTIONAL_ISTIO</span><span class="o">=</span><span class="n">true</span> <span class="n">CANVAS_CTK_OPTIONAL_KEYCLOAK</span><span class="o">=</span><span class="n">true</span> <span class="n">npm</span> <span class="n">test</span>
</pre></div>
</div>
<p>Example output:</p>
<p><img alt="gif showing the ctk in action and results" src="../../_images/canvas-ctk.gif" /></p>
</div>
<div class="section" id="kubernetes-conformance">
<h2>Kubernetes Conformance<a class="headerlink" href="#kubernetes-conformance" title="Permalink to this headline">¶</a></h2>
<p>In addition to the tests created within this repository, we can (and should) also run the e2e conformance tests that are provided by the Kubernetes core project.  Basic steps (example for v0.53.2) can be found below, for more information please <a class="reference external" href="https://sonobuoy.io/docs">read the docs for Sonobuoy</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note you can browse to the latest release here: https://github.com/vmware-tanzu/sonobuoy/releases/latest</span>

wget https://github.com/vmware-tanzu/sonobuoy/releases/download/v0.53.2/sonobuoy_0.53.2_darwin_amd64.tar.gz
tar -xvf sonobuoy_0.53.2_darwin_amd64.tar.gz
mv sonobuoy /usr/local/bin

<span class="c1"># Make sure you have a valid KUBECONFIG file in place and are using the correct context</span>
sonobuoy run --wait     <span class="c1"># Just remove the --wait for async operation</span>
<span class="c1"># or, for a quicker result (full tests can take a loooong time - over an hour is not unusual)</span>
sonobuoy run --mode quick   <span class="c1"># Again, remove --wait for async</span>
<span class="c1"># If you didn&#39;t use --wait, you can check the status </span>
sonobuoy status

<span class="c1"># Once finished, get the results and view the summary</span>
<span class="nv">results</span><span class="o">=</span><span class="k">$(</span>sonobuoy retrieve<span class="k">)</span>
sonobuoy results <span class="nv">$results</span>
<span class="c1"># Example output:</span>
Plugin: systemd-logs
Status: passed
Total: <span class="m">1</span>
Passed: <span class="m">1</span>
Failed: <span class="m">0</span>
Skipped: <span class="m">0</span>

Plugin: e2e
Status: failed
Total: <span class="m">6432</span>
Passed: <span class="m">342</span>
Failed: <span class="m">2</span>
Skipped: <span class="m">6088</span>

Failed tests:
<span class="o">[</span>sig-apps<span class="o">]</span> Daemon <span class="nb">set</span> <span class="o">[</span>Serial<span class="o">]</span> should rollback without unnecessary restarts <span class="o">[</span>Conformance<span class="o">]</span>
<span class="o">[</span>sig-network<span class="o">]</span> HostPort validates that there is no conflict between pods with same hostPort but different hostIP and protocol <span class="o">[</span>LinuxOnly<span class="o">]</span> <span class="o">[</span>Conformance<span class="o">]</span>

<span class="c1"># Clean up</span>
sonobuoy delete --all --wait
</pre></div>
</div>
</div>
<div class="section" id="developing-and-extending-the-tests">
<h2>Developing and extending the tests<a class="headerlink" href="#developing-and-extending-the-tests" title="Permalink to this headline">¶</a></h2>
<p>The CTK tests are written in NodeJS using the <a class="reference external" href="https://mochajs.org/">Mocha</a> test framework and the <a class="reference external" href="https://www.chaijs.com/">Chai</a> test assertion library.</p>
<p>At present, there is just one <a class="reference external" href="tests.js">test.js</a> script with all the tests in - we may choose to split this at a later date.
This script is called from the <a class="reference external" href="package.json">package.json</a> file using the <code class="docutils literal notranslate"><span class="pre">mocha</span></code> command.
The second script simply adds an environment variable to stop the optional tests being run.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>  <span class="nt">&quot;scripts&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;mocha tests.js&quot;</span>
  <span class="p">},</span>
</pre></div>
</div>
<p>This means to execute the tests, we simply use <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">test</span></code>.</p>
<p>A simple example of an assertion test is found below.
For each section of testing there is a <code class="docutils literal notranslate"><span class="pre">describe</span></code> method where you set-up the data required for the test, and then an <code class="docutils literal notranslate"><span class="pre">it</span></code> method for each test.
A test will contain one or more assertions using the Chai library <code class="docutils literal notranslate"><span class="pre">expect</span></code> method (or <code class="docutils literal notranslate"><span class="pre">should</span></code>, depending on the requirement).</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;Basic Kubernetes checks&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Can connect to the cluster&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k8sApi</span><span class="p">.</span><span class="nx">listNode</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">expect</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">not</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="kc">null</span>
            <span class="nx">done</span><span class="p">()</span>
        <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, TM Forum ODA-Component Accelerator project.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>